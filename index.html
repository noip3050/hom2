<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Indoor Navigation</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- السماء -->
      <a-sky color="#ECECEC"></a-sky>

      <!-- المجموعة التي تحتوي على البيئة -->
      <a-entity id="world">
        <!-- الجدران الخارجية -->
        <a-box position="0 1.5 -15" width="30" height="3" depth="0.2" color="#888"></a-box>
        <a-box position="-15 1.5 0" width="0.2" height="3" depth="30" color="#888"></a-box>
        <a-box position="15 1.5 0" width="0.2" height="3" depth="30" color="#888"></a-box>
        <a-box position="0 1.5 15" width="30" height="3" depth="0.2" color="#888"></a-box>

        <!-- الغرف -->
        <a-box position="-10 1.5 -10" width="8" height="3" depth="8" color="#FFC300">
          <a-text
            value="المطبخ"
            position="0 1.8 0"
            align="center"
            color="#000"
          ></a-text>
        </a-box>

        <a-box position="10 1.5 -10" width="8" height="3" depth="8" color="#4CAF50">
          <a-text
            value="غرفة النوم"
            position="0 1.8 0"
            align="center"
            color="#FFF"
          ></a-text>
        </a-box>

        <a-box position="0 1.5 10" width="8" height="3" depth="8" color="#2196F3">
          <a-text
            value="المجلس"
            position="0 1.8 0"
            align="center"
            color="#FFF"
          ></a-text>
        </a-box>
      </a-entity>

      <!-- الكاميرا -->
      <a-camera position="0 1.6 0"></a-camera>
    </a-scene>

    <script>
      const world = document.querySelector("#world");

      let steps = 0; // عدد الخطوات
      let lastZ = null; // لتخزين آخر قيمة للمحور Z

      // وظيفة تتبع الحركة
      function handleMotion(event) {
        const acc = event.accelerationIncludingGravity;

        if (lastZ === null) lastZ = acc.z;

        // حساب الفرق في الحركة على المحور Z
        const deltaZ = acc.z - lastZ;

        // إذا تحرك المستخدم للأمام
        if (Math.abs(deltaZ) > 0.5) {
          steps++;

          const currentWorldPosition = world.getAttribute("position") || { x: 0, y: 0, z: 0 };

          // تحريك العالم الافتراضي بالنسبة للمستخدم
          world.setAttribute("position", {
            x: currentWorldPosition.x,
            y: currentWorldPosition.y,
            z: currentWorldPosition.z + (deltaZ > 0 ? -0.2 : 0.2),
          });

          console.log(`خطواتك: ${steps}`);
        }

        lastZ = acc.z;
      }

      // تشغيل وظيفة تتبع الحركة
      window.addEventListener("devicemotion", handleMotion);
    </script>
  </body>
</html>
