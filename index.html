<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Walking Navigation</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- البيئة -->
      <a-sky color="#ECECEC"></a-sky>

      <!-- الجدران والغرف -->
      <a-box position="0 1.5 -10" width="20" height="3" depth="0.2" color="#888"></a-box>
      <a-box position="-10 1.5 0" width="0.2" height="3" depth="20" color="#888"></a-box>
      <a-box position="10 1.5 0" width="0.2" height="3" depth="20" color="#888"></a-box>
      <a-box position="0 1.5 10" width="20" height="3" depth="0.2" color="#888"></a-box>

      <!-- الغرف -->
      <a-box
        position="-7.5 1.5 -7.5"
        width="5"
        height="3"
        depth="5"
        color="#FFC300"
      >
        <a-text
          value="المطبخ"
          position="0 1.8 0"
          align="center"
          color="#000"
        ></a-text>
      </a-box>

      <a-box
        position="7.5 1.5 -7.5"
        width="5"
        height="3"
        depth="5"
        color="#4CAF50"
      >
        <a-text
          value="غرفة النوم"
          position="0 1.8 0"
          align="center"
          color="#FFF"
        ></a-text>
      </a-box>

      <a-box
        position="0 1.5 7.5"
        width="5"
        height="3"
        depth="5"
        color="#2196F3"
      >
        <a-text
          value="المجلس"
          position="0 1.8 0"
          align="center"
          color="#FFF"
        ></a-text>
      </a-box>

      <!-- الكاميرا -->
      <a-entity id="camera" camera position="0 1.6 0">
        <a-camera position="0 1.6 0"></a-camera>
      </a-entity>
    </a-scene>

    <script>
      const camera = document.querySelector("#camera");
      let lastZ = null; // لتخزين آخر قيمة للمحور Z

      // وظيفة تتبع الحركة
      function handleMotion(event) {
        const acc = event.accelerationIncludingGravity;

        if (lastZ === null) lastZ = acc.z;

        // حساب الفرق في الحركة على المحور Z
        const deltaZ = acc.z - lastZ;

        // إذا تحرك المستخدم للأمام أو للخلف
        if (Math.abs(deltaZ) > 0.5) {
          const currentPosition = camera.getAttribute("position");

          // تحريك الكاميرا بناءً على الاتجاه
          camera.setAttribute("position", {
            x: currentPosition.x,
            y: currentPosition.y,
            z: currentPosition.z + (deltaZ > 0 ? -0.1 : 0.1),
          });
        }

        lastZ = acc.z;
      }

      // تفعيل تتبع الحركة
      window.addEventListener("devicemotion", handleMotion);
    </script>
  </body>
</html>
